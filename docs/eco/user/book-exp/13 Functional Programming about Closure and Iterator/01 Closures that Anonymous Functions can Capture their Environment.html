<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>匿名函数 Closure | kriry技术</title>
    <meta name="description" content="始于开发者, 服务于开发者的网络资源">
    <link rel="icon" href="/favicon.ico">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#3eaf7c">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon-152x152.png">
  <meta name="msapplication-TileImage" content="/icons/msapplication-icon-144x144.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.b0415a31.css" as="style"><link rel="preload" href="/assets/js/app.d3c8f621.js" as="script"><link rel="preload" href="/assets/js/623.6aaba041.js" as="script"><link rel="prefetch" href="/assets/js/10.64b85aac.js"><link rel="prefetch" href="/assets/js/100.1fc123d1.js"><link rel="prefetch" href="/assets/js/101.4774d92e.js"><link rel="prefetch" href="/assets/js/102.f75202a2.js"><link rel="prefetch" href="/assets/js/103.294dcc1e.js"><link rel="prefetch" href="/assets/js/104.cdda5855.js"><link rel="prefetch" href="/assets/js/105.11864f1f.js"><link rel="prefetch" href="/assets/js/106.e2f681ea.js"><link rel="prefetch" href="/assets/js/107.13ae51bb.js"><link rel="prefetch" href="/assets/js/108.11a8cdb5.js"><link rel="prefetch" href="/assets/js/109.6689a474.js"><link rel="prefetch" href="/assets/js/11.9e7b87f9.js"><link rel="prefetch" href="/assets/js/110.92befbcd.js"><link rel="prefetch" href="/assets/js/111.32b62e7b.js"><link rel="prefetch" href="/assets/js/112.809cb97a.js"><link rel="prefetch" href="/assets/js/113.450610a2.js"><link rel="prefetch" href="/assets/js/114.e1b03d5e.js"><link rel="prefetch" href="/assets/js/115.b213e0a7.js"><link rel="prefetch" href="/assets/js/116.4b807632.js"><link rel="prefetch" href="/assets/js/117.ca378aed.js"><link rel="prefetch" href="/assets/js/118.79f09036.js"><link rel="prefetch" href="/assets/js/119.7a5e6977.js"><link rel="prefetch" href="/assets/js/12.cbd79a0c.js"><link rel="prefetch" href="/assets/js/120.847e15f5.js"><link rel="prefetch" href="/assets/js/121.bc68a1f8.js"><link rel="prefetch" href="/assets/js/122.5d1fe5bf.js"><link rel="prefetch" href="/assets/js/123.86ed72bf.js"><link rel="prefetch" href="/assets/js/124.43da0243.js"><link rel="prefetch" href="/assets/js/125.bba47127.js"><link rel="prefetch" href="/assets/js/126.009522fa.js"><link rel="prefetch" href="/assets/js/127.f83cea5c.js"><link rel="prefetch" href="/assets/js/128.3947e4d3.js"><link rel="prefetch" href="/assets/js/129.3eb3e6d3.js"><link rel="prefetch" href="/assets/js/13.b0184bcc.js"><link rel="prefetch" href="/assets/js/130.487acd2d.js"><link rel="prefetch" href="/assets/js/131.5887d86b.js"><link rel="prefetch" href="/assets/js/132.57b4d354.js"><link rel="prefetch" href="/assets/js/133.95a6856c.js"><link rel="prefetch" href="/assets/js/134.f3a33597.js"><link rel="prefetch" href="/assets/js/135.dcff2a53.js"><link rel="prefetch" href="/assets/js/136.54a29fff.js"><link rel="prefetch" href="/assets/js/137.1643e3d3.js"><link rel="prefetch" href="/assets/js/138.dc49ffc8.js"><link rel="prefetch" href="/assets/js/139.22ef4ac2.js"><link rel="prefetch" href="/assets/js/14.78bcfdc6.js"><link rel="prefetch" href="/assets/js/140.ad9dee3e.js"><link rel="prefetch" href="/assets/js/141.109ba333.js"><link rel="prefetch" href="/assets/js/142.9f48f794.js"><link rel="prefetch" href="/assets/js/143.afc6daa6.js"><link rel="prefetch" href="/assets/js/144.a83be383.js"><link rel="prefetch" href="/assets/js/145.14e1fab2.js"><link rel="prefetch" href="/assets/js/146.12c93bf6.js"><link rel="prefetch" href="/assets/js/147.6fb613e6.js"><link rel="prefetch" href="/assets/js/148.31a08161.js"><link rel="prefetch" href="/assets/js/149.901eb3f5.js"><link rel="prefetch" href="/assets/js/15.c34bf0e1.js"><link rel="prefetch" href="/assets/js/150.0f0d007b.js"><link rel="prefetch" href="/assets/js/151.8b2d6258.js"><link rel="prefetch" href="/assets/js/152.c82bfb41.js"><link rel="prefetch" href="/assets/js/153.dfe1f866.js"><link rel="prefetch" href="/assets/js/154.7ebd9869.js"><link rel="prefetch" href="/assets/js/155.f529b21a.js"><link rel="prefetch" href="/assets/js/156.e9a4a3b2.js"><link rel="prefetch" href="/assets/js/157.4f584b8f.js"><link rel="prefetch" href="/assets/js/158.b69265ea.js"><link rel="prefetch" href="/assets/js/159.dce9aece.js"><link rel="prefetch" href="/assets/js/16.8393f9b5.js"><link rel="prefetch" href="/assets/js/160.e17d16ab.js"><link rel="prefetch" href="/assets/js/161.582395b6.js"><link rel="prefetch" href="/assets/js/162.73c7af34.js"><link rel="prefetch" href="/assets/js/163.da3b0733.js"><link rel="prefetch" href="/assets/js/164.6f3a24b6.js"><link rel="prefetch" href="/assets/js/165.0dac2b94.js"><link rel="prefetch" href="/assets/js/166.47ad7047.js"><link rel="prefetch" href="/assets/js/167.7c2412b4.js"><link rel="prefetch" href="/assets/js/168.8568ea12.js"><link rel="prefetch" href="/assets/js/169.e3d8fb49.js"><link rel="prefetch" href="/assets/js/17.3d9e63f1.js"><link rel="prefetch" href="/assets/js/170.ba98d2a0.js"><link rel="prefetch" href="/assets/js/171.b9d92bff.js"><link rel="prefetch" href="/assets/js/172.c3702a04.js"><link rel="prefetch" href="/assets/js/173.f6b060dd.js"><link rel="prefetch" href="/assets/js/174.6be17507.js"><link rel="prefetch" href="/assets/js/175.87524196.js"><link rel="prefetch" href="/assets/js/176.dba9c812.js"><link rel="prefetch" href="/assets/js/177.d65d6af1.js"><link rel="prefetch" href="/assets/js/178.0de71f3b.js"><link rel="prefetch" href="/assets/js/179.b24830d6.js"><link rel="prefetch" href="/assets/js/18.a75de37c.js"><link rel="prefetch" href="/assets/js/180.ce91deef.js"><link rel="prefetch" href="/assets/js/181.e1121281.js"><link rel="prefetch" href="/assets/js/182.ad532dba.js"><link rel="prefetch" href="/assets/js/183.01dc5f77.js"><link rel="prefetch" href="/assets/js/184.c04acd1d.js"><link rel="prefetch" href="/assets/js/185.362a669b.js"><link rel="prefetch" href="/assets/js/186.6ff9c4dc.js"><link rel="prefetch" href="/assets/js/187.6a1ab8e8.js"><link rel="prefetch" href="/assets/js/188.0f0a3252.js"><link rel="prefetch" href="/assets/js/189.a0552a27.js"><link rel="prefetch" href="/assets/js/19.3803267b.js"><link rel="prefetch" href="/assets/js/190.93b3fd0c.js"><link rel="prefetch" href="/assets/js/191.b6dc0c89.js"><link rel="prefetch" href="/assets/js/192.725c7fb1.js"><link rel="prefetch" href="/assets/js/193.688b4832.js"><link rel="prefetch" href="/assets/js/194.985120e0.js"><link rel="prefetch" href="/assets/js/195.522ef15f.js"><link rel="prefetch" href="/assets/js/196.0c5772ef.js"><link rel="prefetch" href="/assets/js/197.b46d3065.js"><link rel="prefetch" href="/assets/js/198.b20fee4f.js"><link rel="prefetch" href="/assets/js/199.d3bba2c6.js"><link rel="prefetch" href="/assets/js/2.51db2dbd.js"><link rel="prefetch" href="/assets/js/20.2354855d.js"><link rel="prefetch" href="/assets/js/200.d6308429.js"><link rel="prefetch" href="/assets/js/201.2a0ed53e.js"><link rel="prefetch" href="/assets/js/202.0da3cd7b.js"><link rel="prefetch" href="/assets/js/203.696982fb.js"><link rel="prefetch" href="/assets/js/204.097e8052.js"><link rel="prefetch" href="/assets/js/205.e4c3c50b.js"><link rel="prefetch" href="/assets/js/206.aadf0fdf.js"><link rel="prefetch" href="/assets/js/207.6fe68fd6.js"><link rel="prefetch" href="/assets/js/208.d5ee900f.js"><link rel="prefetch" href="/assets/js/209.174685f6.js"><link rel="prefetch" href="/assets/js/21.2c69d334.js"><link rel="prefetch" href="/assets/js/210.7498ad32.js"><link rel="prefetch" href="/assets/js/211.2c5477cf.js"><link rel="prefetch" href="/assets/js/212.355d42b3.js"><link rel="prefetch" href="/assets/js/213.bd4581e6.js"><link rel="prefetch" href="/assets/js/214.9964a07e.js"><link rel="prefetch" href="/assets/js/215.295c29e6.js"><link rel="prefetch" href="/assets/js/216.35af5162.js"><link rel="prefetch" href="/assets/js/217.68495252.js"><link rel="prefetch" href="/assets/js/218.781ae4b2.js"><link rel="prefetch" href="/assets/js/219.7ae81bd1.js"><link rel="prefetch" href="/assets/js/22.968f7540.js"><link rel="prefetch" href="/assets/js/220.60d9341d.js"><link rel="prefetch" href="/assets/js/221.39b497ea.js"><link rel="prefetch" href="/assets/js/222.ef3a6b65.js"><link rel="prefetch" href="/assets/js/223.c82520bb.js"><link rel="prefetch" href="/assets/js/224.d3146cad.js"><link rel="prefetch" href="/assets/js/225.3602a497.js"><link rel="prefetch" href="/assets/js/226.5dddfcc0.js"><link rel="prefetch" href="/assets/js/227.59fac0fb.js"><link rel="prefetch" href="/assets/js/228.0c7cbfa7.js"><link rel="prefetch" href="/assets/js/229.09c32f1d.js"><link rel="prefetch" href="/assets/js/23.d98a7265.js"><link rel="prefetch" href="/assets/js/230.f4ff493e.js"><link rel="prefetch" href="/assets/js/231.f2679a03.js"><link rel="prefetch" href="/assets/js/232.4899affd.js"><link rel="prefetch" href="/assets/js/233.fd1c6d05.js"><link rel="prefetch" href="/assets/js/234.ce73104d.js"><link rel="prefetch" href="/assets/js/235.7085bf06.js"><link rel="prefetch" href="/assets/js/236.1fc1eadf.js"><link rel="prefetch" href="/assets/js/237.1dafd265.js"><link rel="prefetch" href="/assets/js/238.bd05752f.js"><link rel="prefetch" href="/assets/js/239.b75abd36.js"><link rel="prefetch" href="/assets/js/24.56d84234.js"><link rel="prefetch" href="/assets/js/240.ef25a303.js"><link rel="prefetch" href="/assets/js/241.550608d8.js"><link rel="prefetch" href="/assets/js/242.35e6a722.js"><link rel="prefetch" href="/assets/js/243.7a6a3ab1.js"><link rel="prefetch" href="/assets/js/244.3a539932.js"><link rel="prefetch" href="/assets/js/245.1da5f137.js"><link rel="prefetch" href="/assets/js/246.3193eea3.js"><link rel="prefetch" href="/assets/js/247.8ce455e6.js"><link rel="prefetch" href="/assets/js/248.740b000c.js"><link rel="prefetch" href="/assets/js/249.1a95a27f.js"><link rel="prefetch" href="/assets/js/25.7fa48d63.js"><link rel="prefetch" href="/assets/js/250.004fd861.js"><link rel="prefetch" href="/assets/js/251.2364f7ad.js"><link rel="prefetch" href="/assets/js/252.0b673238.js"><link rel="prefetch" href="/assets/js/253.998a52ae.js"><link rel="prefetch" href="/assets/js/254.7e6d39a8.js"><link rel="prefetch" href="/assets/js/255.9b0e4bed.js"><link rel="prefetch" href="/assets/js/256.f8fbc0ea.js"><link rel="prefetch" href="/assets/js/257.acbbbae0.js"><link rel="prefetch" href="/assets/js/258.ea85bda6.js"><link rel="prefetch" href="/assets/js/259.dbd04116.js"><link rel="prefetch" href="/assets/js/26.b4350e9f.js"><link rel="prefetch" href="/assets/js/260.7f8c9ed4.js"><link rel="prefetch" href="/assets/js/261.902f4119.js"><link rel="prefetch" href="/assets/js/262.ebecddbf.js"><link rel="prefetch" href="/assets/js/263.55dd9810.js"><link rel="prefetch" href="/assets/js/264.5ffa85ab.js"><link rel="prefetch" href="/assets/js/265.d42ae784.js"><link rel="prefetch" href="/assets/js/266.79d3e6e7.js"><link rel="prefetch" href="/assets/js/267.40f4d300.js"><link rel="prefetch" href="/assets/js/268.8d5088c0.js"><link rel="prefetch" href="/assets/js/269.115b587a.js"><link rel="prefetch" href="/assets/js/27.e7bfdc5c.js"><link rel="prefetch" href="/assets/js/270.4422c554.js"><link rel="prefetch" href="/assets/js/271.442c4ba2.js"><link rel="prefetch" href="/assets/js/272.b95f52bc.js"><link rel="prefetch" href="/assets/js/273.36d07242.js"><link rel="prefetch" href="/assets/js/274.264ddf40.js"><link rel="prefetch" href="/assets/js/275.6a10ed2a.js"><link rel="prefetch" href="/assets/js/276.3f0b4b73.js"><link rel="prefetch" href="/assets/js/277.23da4f95.js"><link rel="prefetch" href="/assets/js/278.d693fd17.js"><link rel="prefetch" href="/assets/js/279.680d8a5f.js"><link rel="prefetch" href="/assets/js/28.fe83dd98.js"><link rel="prefetch" href="/assets/js/280.deb1544b.js"><link rel="prefetch" href="/assets/js/281.20716500.js"><link rel="prefetch" href="/assets/js/282.4cec3001.js"><link rel="prefetch" href="/assets/js/283.ad4038d2.js"><link rel="prefetch" href="/assets/js/284.8cc9fa89.js"><link rel="prefetch" href="/assets/js/285.e2ef4093.js"><link rel="prefetch" href="/assets/js/286.926a666a.js"><link rel="prefetch" href="/assets/js/287.11ce7bfb.js"><link rel="prefetch" href="/assets/js/288.29eafab6.js"><link rel="prefetch" href="/assets/js/289.a59337e5.js"><link rel="prefetch" href="/assets/js/29.972e03ce.js"><link rel="prefetch" href="/assets/js/290.d433de45.js"><link rel="prefetch" href="/assets/js/291.ff4a4114.js"><link rel="prefetch" href="/assets/js/292.5ad3af68.js"><link rel="prefetch" href="/assets/js/293.139eb402.js"><link rel="prefetch" href="/assets/js/294.3214b7ae.js"><link rel="prefetch" href="/assets/js/295.ca2ce703.js"><link rel="prefetch" href="/assets/js/296.d3c51415.js"><link rel="prefetch" href="/assets/js/297.b1d76129.js"><link rel="prefetch" href="/assets/js/298.3b7d759d.js"><link rel="prefetch" href="/assets/js/299.81fc59f4.js"><link rel="prefetch" href="/assets/js/3.8401b4d4.js"><link rel="prefetch" href="/assets/js/30.b418c356.js"><link rel="prefetch" href="/assets/js/300.2ed4962d.js"><link rel="prefetch" href="/assets/js/301.ee85a516.js"><link rel="prefetch" href="/assets/js/302.2e681887.js"><link rel="prefetch" href="/assets/js/303.3974f147.js"><link rel="prefetch" href="/assets/js/304.901cdb00.js"><link rel="prefetch" href="/assets/js/305.25b0dcc3.js"><link rel="prefetch" href="/assets/js/306.6963c639.js"><link rel="prefetch" href="/assets/js/307.9be6b374.js"><link rel="prefetch" href="/assets/js/308.6ee2cb82.js"><link rel="prefetch" href="/assets/js/309.29adc40e.js"><link rel="prefetch" href="/assets/js/31.26809f31.js"><link rel="prefetch" href="/assets/js/310.b1301173.js"><link rel="prefetch" href="/assets/js/311.55398296.js"><link rel="prefetch" href="/assets/js/312.5467cce4.js"><link rel="prefetch" href="/assets/js/313.1dc1ff94.js"><link rel="prefetch" href="/assets/js/314.a792c6a3.js"><link rel="prefetch" href="/assets/js/315.c2b677e0.js"><link rel="prefetch" href="/assets/js/316.4975289e.js"><link rel="prefetch" href="/assets/js/317.915421b6.js"><link rel="prefetch" href="/assets/js/318.795b779c.js"><link rel="prefetch" href="/assets/js/319.39738d87.js"><link rel="prefetch" href="/assets/js/32.d60b2388.js"><link rel="prefetch" href="/assets/js/320.745d0d2c.js"><link rel="prefetch" href="/assets/js/321.d9c48ddf.js"><link rel="prefetch" href="/assets/js/322.636fc6ee.js"><link rel="prefetch" href="/assets/js/323.811324e8.js"><link rel="prefetch" href="/assets/js/324.aad8c1de.js"><link rel="prefetch" href="/assets/js/325.e52746d4.js"><link rel="prefetch" href="/assets/js/326.8c2ede88.js"><link rel="prefetch" href="/assets/js/327.84f21678.js"><link rel="prefetch" href="/assets/js/328.f9b82b12.js"><link rel="prefetch" href="/assets/js/329.619270e8.js"><link rel="prefetch" href="/assets/js/33.f9025f54.js"><link rel="prefetch" href="/assets/js/330.8bd18926.js"><link rel="prefetch" href="/assets/js/331.6f541f5c.js"><link rel="prefetch" href="/assets/js/332.3c714ac1.js"><link rel="prefetch" href="/assets/js/333.5fa7ad9b.js"><link rel="prefetch" href="/assets/js/334.13e243f3.js"><link rel="prefetch" href="/assets/js/335.4880e449.js"><link rel="prefetch" href="/assets/js/336.5c3312c2.js"><link rel="prefetch" href="/assets/js/337.4c0cc05e.js"><link rel="prefetch" href="/assets/js/338.2a7a9f9b.js"><link rel="prefetch" href="/assets/js/339.4f6e8b0e.js"><link rel="prefetch" href="/assets/js/34.a82f7bf6.js"><link rel="prefetch" href="/assets/js/340.05290f7e.js"><link rel="prefetch" href="/assets/js/341.c5f275b9.js"><link rel="prefetch" href="/assets/js/342.59cb0f22.js"><link rel="prefetch" href="/assets/js/343.155709d7.js"><link rel="prefetch" href="/assets/js/344.b0decde5.js"><link rel="prefetch" href="/assets/js/345.5e05b182.js"><link rel="prefetch" href="/assets/js/346.3b05895c.js"><link rel="prefetch" href="/assets/js/347.c2d483c4.js"><link rel="prefetch" href="/assets/js/348.ea7b83aa.js"><link rel="prefetch" href="/assets/js/349.f285961e.js"><link rel="prefetch" href="/assets/js/35.0704d866.js"><link rel="prefetch" href="/assets/js/350.024af132.js"><link rel="prefetch" href="/assets/js/351.8cb6c58f.js"><link rel="prefetch" href="/assets/js/352.0d6de25f.js"><link rel="prefetch" href="/assets/js/353.ca027398.js"><link rel="prefetch" href="/assets/js/354.42e45da6.js"><link rel="prefetch" href="/assets/js/355.06de84ef.js"><link rel="prefetch" href="/assets/js/356.3f7e6096.js"><link rel="prefetch" href="/assets/js/357.5ec07713.js"><link rel="prefetch" href="/assets/js/358.fa61615c.js"><link rel="prefetch" href="/assets/js/359.769da366.js"><link rel="prefetch" href="/assets/js/36.404125d2.js"><link rel="prefetch" href="/assets/js/360.6af80d7f.js"><link rel="prefetch" href="/assets/js/361.e808cb20.js"><link rel="prefetch" href="/assets/js/362.1966a54b.js"><link rel="prefetch" href="/assets/js/363.003fa8ff.js"><link rel="prefetch" href="/assets/js/364.0cf3c4e9.js"><link rel="prefetch" href="/assets/js/365.59b6987c.js"><link rel="prefetch" href="/assets/js/366.f6466697.js"><link rel="prefetch" href="/assets/js/367.857fd699.js"><link rel="prefetch" href="/assets/js/368.965fd5e1.js"><link rel="prefetch" href="/assets/js/369.b5d545ec.js"><link rel="prefetch" href="/assets/js/37.4bb58a18.js"><link rel="prefetch" href="/assets/js/370.aedb85d9.js"><link rel="prefetch" href="/assets/js/371.40aaaf45.js"><link rel="prefetch" href="/assets/js/372.695b22ac.js"><link rel="prefetch" href="/assets/js/373.1d1d962c.js"><link rel="prefetch" href="/assets/js/374.3b4fb683.js"><link rel="prefetch" href="/assets/js/375.a0a9d76d.js"><link rel="prefetch" href="/assets/js/376.2cafac93.js"><link rel="prefetch" href="/assets/js/377.a7319f7c.js"><link rel="prefetch" href="/assets/js/378.ec6bf6b5.js"><link rel="prefetch" href="/assets/js/379.50b81352.js"><link rel="prefetch" href="/assets/js/38.f6139b5c.js"><link rel="prefetch" href="/assets/js/380.f7ceacaf.js"><link rel="prefetch" href="/assets/js/381.60a34864.js"><link rel="prefetch" href="/assets/js/382.f48cea1f.js"><link rel="prefetch" href="/assets/js/383.a06a9046.js"><link rel="prefetch" href="/assets/js/384.0bdf1395.js"><link rel="prefetch" href="/assets/js/385.1afb6421.js"><link rel="prefetch" href="/assets/js/386.6c736c89.js"><link rel="prefetch" href="/assets/js/387.60e346a3.js"><link rel="prefetch" href="/assets/js/388.279c72c6.js"><link rel="prefetch" href="/assets/js/389.d870154d.js"><link rel="prefetch" href="/assets/js/39.729250ed.js"><link rel="prefetch" href="/assets/js/390.630142cf.js"><link rel="prefetch" href="/assets/js/391.6904696c.js"><link rel="prefetch" href="/assets/js/392.5fee5631.js"><link rel="prefetch" href="/assets/js/393.e892ba36.js"><link rel="prefetch" href="/assets/js/394.6cb8cc81.js"><link rel="prefetch" href="/assets/js/395.f2af60a9.js"><link rel="prefetch" href="/assets/js/396.ce69a5ed.js"><link rel="prefetch" href="/assets/js/397.61dfc29a.js"><link rel="prefetch" href="/assets/js/398.01779561.js"><link rel="prefetch" href="/assets/js/399.f3a48234.js"><link rel="prefetch" href="/assets/js/4.7b63d948.js"><link rel="prefetch" href="/assets/js/40.2f46a5af.js"><link rel="prefetch" href="/assets/js/400.08b7b0db.js"><link rel="prefetch" href="/assets/js/401.c983206a.js"><link rel="prefetch" href="/assets/js/402.ae2f3edc.js"><link rel="prefetch" href="/assets/js/403.f6ecc249.js"><link rel="prefetch" href="/assets/js/404.e62db2a1.js"><link rel="prefetch" href="/assets/js/405.5e8b3187.js"><link rel="prefetch" href="/assets/js/406.f5bbf147.js"><link rel="prefetch" href="/assets/js/407.d7c2c978.js"><link rel="prefetch" href="/assets/js/408.4c9b9935.js"><link rel="prefetch" href="/assets/js/409.44ab61a5.js"><link rel="prefetch" href="/assets/js/41.a08caa80.js"><link rel="prefetch" href="/assets/js/410.918e0882.js"><link rel="prefetch" href="/assets/js/411.3e15bfd7.js"><link rel="prefetch" href="/assets/js/412.3d563232.js"><link rel="prefetch" href="/assets/js/413.aa8d8d6d.js"><link rel="prefetch" href="/assets/js/414.6536efed.js"><link rel="prefetch" href="/assets/js/415.ee451275.js"><link rel="prefetch" href="/assets/js/416.b617d354.js"><link rel="prefetch" href="/assets/js/417.200cf654.js"><link rel="prefetch" href="/assets/js/418.b998d5f7.js"><link rel="prefetch" href="/assets/js/419.e806da3d.js"><link rel="prefetch" href="/assets/js/42.06f8b4d5.js"><link rel="prefetch" href="/assets/js/420.f432918b.js"><link rel="prefetch" href="/assets/js/421.c80278a4.js"><link rel="prefetch" href="/assets/js/422.73379d31.js"><link rel="prefetch" href="/assets/js/423.13816ec1.js"><link rel="prefetch" href="/assets/js/424.0d53754d.js"><link rel="prefetch" href="/assets/js/425.9a59e74e.js"><link rel="prefetch" href="/assets/js/426.caf6e6f3.js"><link rel="prefetch" href="/assets/js/427.60aecde1.js"><link rel="prefetch" href="/assets/js/428.383b3536.js"><link rel="prefetch" href="/assets/js/429.d4fea273.js"><link rel="prefetch" href="/assets/js/43.8d129615.js"><link rel="prefetch" href="/assets/js/430.0435710a.js"><link rel="prefetch" href="/assets/js/431.b95fa8f0.js"><link rel="prefetch" href="/assets/js/432.209d318d.js"><link rel="prefetch" href="/assets/js/433.e5c18ca7.js"><link rel="prefetch" href="/assets/js/434.b27c7583.js"><link rel="prefetch" href="/assets/js/435.f46b88c9.js"><link rel="prefetch" href="/assets/js/436.8e4b82d7.js"><link rel="prefetch" href="/assets/js/437.ddbd1ea9.js"><link rel="prefetch" href="/assets/js/438.3b90a97b.js"><link rel="prefetch" href="/assets/js/439.52f9e1d6.js"><link rel="prefetch" href="/assets/js/44.9ed3c652.js"><link rel="prefetch" href="/assets/js/440.dc223e33.js"><link rel="prefetch" href="/assets/js/441.7f82dc47.js"><link rel="prefetch" href="/assets/js/442.d1a97827.js"><link rel="prefetch" href="/assets/js/443.97b666c1.js"><link rel="prefetch" href="/assets/js/444.98b5d211.js"><link rel="prefetch" href="/assets/js/445.7eebd7c3.js"><link rel="prefetch" href="/assets/js/446.c5e099fd.js"><link rel="prefetch" href="/assets/js/447.50171b14.js"><link rel="prefetch" href="/assets/js/448.ff944220.js"><link rel="prefetch" href="/assets/js/449.28055be1.js"><link rel="prefetch" href="/assets/js/45.c8d02623.js"><link rel="prefetch" href="/assets/js/450.a6bb5adc.js"><link rel="prefetch" href="/assets/js/451.95a4ea42.js"><link rel="prefetch" href="/assets/js/452.a24c1b11.js"><link rel="prefetch" href="/assets/js/453.2f24142e.js"><link rel="prefetch" href="/assets/js/454.38eaa047.js"><link rel="prefetch" href="/assets/js/455.ea244abb.js"><link rel="prefetch" href="/assets/js/456.b2d26da1.js"><link rel="prefetch" href="/assets/js/457.dcba58a4.js"><link rel="prefetch" href="/assets/js/458.016b23a5.js"><link rel="prefetch" href="/assets/js/459.e2717b0f.js"><link rel="prefetch" href="/assets/js/46.33c7df85.js"><link rel="prefetch" href="/assets/js/460.b98ded97.js"><link rel="prefetch" href="/assets/js/461.787cd047.js"><link rel="prefetch" href="/assets/js/462.1e5ba461.js"><link rel="prefetch" href="/assets/js/463.eb631100.js"><link rel="prefetch" href="/assets/js/464.9841c067.js"><link rel="prefetch" href="/assets/js/465.66038396.js"><link rel="prefetch" href="/assets/js/466.41c2818f.js"><link rel="prefetch" href="/assets/js/467.d1bdfe6d.js"><link rel="prefetch" href="/assets/js/468.f0156771.js"><link rel="prefetch" href="/assets/js/469.e8ff5d06.js"><link rel="prefetch" href="/assets/js/47.73ebd7f9.js"><link rel="prefetch" href="/assets/js/470.0e97beae.js"><link rel="prefetch" href="/assets/js/471.3b055e27.js"><link rel="prefetch" href="/assets/js/472.d2057ab6.js"><link rel="prefetch" href="/assets/js/473.0d55b2c2.js"><link rel="prefetch" href="/assets/js/474.c2471f5d.js"><link rel="prefetch" href="/assets/js/475.282e32a5.js"><link rel="prefetch" href="/assets/js/476.2671538c.js"><link rel="prefetch" href="/assets/js/477.faaef780.js"><link rel="prefetch" href="/assets/js/478.ef5cfbb6.js"><link rel="prefetch" href="/assets/js/479.17913c81.js"><link rel="prefetch" href="/assets/js/48.188d6549.js"><link rel="prefetch" href="/assets/js/480.89396ec2.js"><link rel="prefetch" href="/assets/js/481.7d9af8bd.js"><link rel="prefetch" href="/assets/js/482.b28947b1.js"><link rel="prefetch" href="/assets/js/483.7a4b86fa.js"><link rel="prefetch" href="/assets/js/484.58590a22.js"><link rel="prefetch" href="/assets/js/485.d80ad813.js"><link rel="prefetch" href="/assets/js/486.1ca2e0bb.js"><link rel="prefetch" href="/assets/js/487.85ac34ca.js"><link rel="prefetch" href="/assets/js/488.19f17cba.js"><link rel="prefetch" href="/assets/js/489.9c5e3bf7.js"><link rel="prefetch" href="/assets/js/49.60b4d873.js"><link rel="prefetch" href="/assets/js/490.5037c432.js"><link rel="prefetch" href="/assets/js/491.aad7748d.js"><link rel="prefetch" href="/assets/js/492.ae6e157a.js"><link rel="prefetch" href="/assets/js/493.9ca7c083.js"><link rel="prefetch" href="/assets/js/494.ae5481db.js"><link rel="prefetch" href="/assets/js/495.232e337d.js"><link rel="prefetch" href="/assets/js/496.68cfea35.js"><link rel="prefetch" href="/assets/js/497.7ba31ca7.js"><link rel="prefetch" href="/assets/js/498.92ff52b1.js"><link rel="prefetch" href="/assets/js/499.f12888d6.js"><link rel="prefetch" href="/assets/js/5.c5b940c0.js"><link rel="prefetch" href="/assets/js/50.5ed9c1ec.js"><link rel="prefetch" href="/assets/js/500.26d3ca36.js"><link rel="prefetch" href="/assets/js/501.725dcb7e.js"><link rel="prefetch" href="/assets/js/502.1270051b.js"><link rel="prefetch" href="/assets/js/503.80d1ea82.js"><link rel="prefetch" href="/assets/js/504.dfb2eba5.js"><link rel="prefetch" href="/assets/js/505.d39121df.js"><link rel="prefetch" href="/assets/js/506.12f398ce.js"><link rel="prefetch" href="/assets/js/507.8c6cdee0.js"><link rel="prefetch" href="/assets/js/508.8a321baf.js"><link rel="prefetch" href="/assets/js/509.2d2da978.js"><link rel="prefetch" href="/assets/js/51.055ba882.js"><link rel="prefetch" href="/assets/js/510.375b0cbc.js"><link rel="prefetch" href="/assets/js/511.fc507eba.js"><link rel="prefetch" href="/assets/js/512.429ee885.js"><link rel="prefetch" href="/assets/js/513.3d0ccb69.js"><link rel="prefetch" href="/assets/js/514.4fe3b7f0.js"><link rel="prefetch" href="/assets/js/515.0ac19724.js"><link rel="prefetch" href="/assets/js/516.0f056b61.js"><link rel="prefetch" href="/assets/js/517.4aea4a51.js"><link rel="prefetch" href="/assets/js/518.75819565.js"><link rel="prefetch" href="/assets/js/519.a44727cc.js"><link rel="prefetch" href="/assets/js/52.90d7c8cd.js"><link rel="prefetch" href="/assets/js/520.294f4221.js"><link rel="prefetch" href="/assets/js/521.8eb861b2.js"><link rel="prefetch" href="/assets/js/522.9ebecd3a.js"><link rel="prefetch" href="/assets/js/523.cc887fda.js"><link rel="prefetch" href="/assets/js/524.684649a0.js"><link rel="prefetch" href="/assets/js/525.26401e3b.js"><link rel="prefetch" href="/assets/js/526.719ce1d5.js"><link rel="prefetch" href="/assets/js/527.7e87b47a.js"><link rel="prefetch" href="/assets/js/528.23ce156e.js"><link rel="prefetch" href="/assets/js/529.4a22ba70.js"><link rel="prefetch" href="/assets/js/53.e5228283.js"><link rel="prefetch" href="/assets/js/530.0e733a1d.js"><link rel="prefetch" href="/assets/js/531.fc9f3598.js"><link rel="prefetch" href="/assets/js/532.14d329ef.js"><link rel="prefetch" href="/assets/js/533.e1d68184.js"><link rel="prefetch" href="/assets/js/534.46ffd7f4.js"><link rel="prefetch" href="/assets/js/535.c4233fac.js"><link rel="prefetch" href="/assets/js/536.e2a91624.js"><link rel="prefetch" href="/assets/js/537.d1715cd4.js"><link rel="prefetch" href="/assets/js/538.2817df36.js"><link rel="prefetch" href="/assets/js/539.5d76fe01.js"><link rel="prefetch" href="/assets/js/54.6da1f6e2.js"><link rel="prefetch" href="/assets/js/540.dd958734.js"><link rel="prefetch" href="/assets/js/541.3661942a.js"><link rel="prefetch" href="/assets/js/542.7f8c0400.js"><link rel="prefetch" href="/assets/js/543.b51ecba9.js"><link rel="prefetch" href="/assets/js/544.cdbe4dab.js"><link rel="prefetch" href="/assets/js/545.dd1e0425.js"><link rel="prefetch" href="/assets/js/546.ac77d062.js"><link rel="prefetch" href="/assets/js/547.0e27af1b.js"><link rel="prefetch" href="/assets/js/548.faf7a7f3.js"><link rel="prefetch" href="/assets/js/549.2ce0700f.js"><link rel="prefetch" href="/assets/js/55.0e4d9415.js"><link rel="prefetch" href="/assets/js/550.4a76ce58.js"><link rel="prefetch" href="/assets/js/551.09c3c147.js"><link rel="prefetch" href="/assets/js/552.24879b36.js"><link rel="prefetch" href="/assets/js/553.05189981.js"><link rel="prefetch" href="/assets/js/554.a528cbc9.js"><link rel="prefetch" href="/assets/js/555.777adfac.js"><link rel="prefetch" href="/assets/js/556.e06a7f20.js"><link rel="prefetch" href="/assets/js/557.b8f5ae89.js"><link rel="prefetch" href="/assets/js/558.8d4f2534.js"><link rel="prefetch" href="/assets/js/559.02612005.js"><link rel="prefetch" href="/assets/js/56.1ab0261c.js"><link rel="prefetch" href="/assets/js/560.4961697a.js"><link rel="prefetch" href="/assets/js/561.699c8844.js"><link rel="prefetch" href="/assets/js/562.7e3b935a.js"><link rel="prefetch" href="/assets/js/563.554f0510.js"><link rel="prefetch" href="/assets/js/564.17333238.js"><link rel="prefetch" href="/assets/js/565.04da523f.js"><link rel="prefetch" href="/assets/js/566.544963a0.js"><link rel="prefetch" href="/assets/js/567.6e6dd899.js"><link rel="prefetch" href="/assets/js/568.de2791e0.js"><link rel="prefetch" href="/assets/js/569.9502ec8d.js"><link rel="prefetch" href="/assets/js/57.cc3c9b9c.js"><link rel="prefetch" href="/assets/js/570.99e71b4a.js"><link rel="prefetch" href="/assets/js/571.8364d56f.js"><link rel="prefetch" href="/assets/js/572.596eac68.js"><link rel="prefetch" href="/assets/js/573.0b0562af.js"><link rel="prefetch" href="/assets/js/574.754ad8d2.js"><link rel="prefetch" href="/assets/js/575.6e12ccd3.js"><link rel="prefetch" href="/assets/js/576.8a7f3397.js"><link rel="prefetch" href="/assets/js/577.32b4c7e6.js"><link rel="prefetch" href="/assets/js/578.96054366.js"><link rel="prefetch" href="/assets/js/579.2e660011.js"><link rel="prefetch" href="/assets/js/58.98ea99d1.js"><link rel="prefetch" href="/assets/js/580.805d1da5.js"><link rel="prefetch" href="/assets/js/581.7d6ed819.js"><link rel="prefetch" href="/assets/js/582.9784ecec.js"><link rel="prefetch" href="/assets/js/583.d0bd53bf.js"><link rel="prefetch" href="/assets/js/584.4aa7d0c5.js"><link rel="prefetch" href="/assets/js/585.12b6df77.js"><link rel="prefetch" href="/assets/js/586.70f74689.js"><link rel="prefetch" href="/assets/js/587.2f14c508.js"><link rel="prefetch" href="/assets/js/588.7912f2e0.js"><link rel="prefetch" href="/assets/js/589.e5734a4e.js"><link rel="prefetch" href="/assets/js/59.506b9867.js"><link rel="prefetch" href="/assets/js/590.019b733f.js"><link rel="prefetch" href="/assets/js/591.0f2fe4b5.js"><link rel="prefetch" href="/assets/js/592.06add3ba.js"><link rel="prefetch" href="/assets/js/593.451c2c7f.js"><link rel="prefetch" href="/assets/js/594.fec6fd67.js"><link rel="prefetch" href="/assets/js/595.13faf473.js"><link rel="prefetch" href="/assets/js/596.38859109.js"><link rel="prefetch" href="/assets/js/597.4b90efc6.js"><link rel="prefetch" href="/assets/js/598.58b0188a.js"><link rel="prefetch" href="/assets/js/599.2725a79b.js"><link rel="prefetch" href="/assets/js/6.be045446.js"><link rel="prefetch" href="/assets/js/60.0642c026.js"><link rel="prefetch" href="/assets/js/600.73efc2fd.js"><link rel="prefetch" href="/assets/js/601.ec59857b.js"><link rel="prefetch" href="/assets/js/602.caa7da25.js"><link rel="prefetch" href="/assets/js/603.c87f949c.js"><link rel="prefetch" href="/assets/js/604.781b939f.js"><link rel="prefetch" href="/assets/js/605.8fbba702.js"><link rel="prefetch" href="/assets/js/606.401e3f91.js"><link rel="prefetch" href="/assets/js/607.59264ad0.js"><link rel="prefetch" href="/assets/js/608.cd54302e.js"><link rel="prefetch" href="/assets/js/609.246c4211.js"><link rel="prefetch" href="/assets/js/61.dfbb94c1.js"><link rel="prefetch" href="/assets/js/610.5694be37.js"><link rel="prefetch" href="/assets/js/611.4a593274.js"><link rel="prefetch" href="/assets/js/612.1118a8b1.js"><link rel="prefetch" href="/assets/js/613.5a21217b.js"><link rel="prefetch" href="/assets/js/614.39a62624.js"><link rel="prefetch" href="/assets/js/615.36638fd9.js"><link rel="prefetch" href="/assets/js/616.65ee6776.js"><link rel="prefetch" href="/assets/js/617.f2265357.js"><link rel="prefetch" href="/assets/js/618.7d0d303f.js"><link rel="prefetch" href="/assets/js/619.7c4da883.js"><link rel="prefetch" href="/assets/js/62.b627977b.js"><link rel="prefetch" href="/assets/js/620.1b417b5c.js"><link rel="prefetch" href="/assets/js/621.ff26a584.js"><link rel="prefetch" href="/assets/js/622.fb866dd2.js"><link rel="prefetch" href="/assets/js/624.9e980c61.js"><link rel="prefetch" href="/assets/js/625.f7b58120.js"><link rel="prefetch" href="/assets/js/626.253a5a8b.js"><link rel="prefetch" href="/assets/js/627.9fe42507.js"><link rel="prefetch" href="/assets/js/628.04df2939.js"><link rel="prefetch" href="/assets/js/629.a1572b93.js"><link rel="prefetch" href="/assets/js/63.847a11c0.js"><link rel="prefetch" href="/assets/js/630.8bd13b35.js"><link rel="prefetch" href="/assets/js/631.5e6f065e.js"><link rel="prefetch" href="/assets/js/632.8f4ea39b.js"><link rel="prefetch" href="/assets/js/633.0a232a2d.js"><link rel="prefetch" href="/assets/js/634.00495da7.js"><link rel="prefetch" href="/assets/js/635.e0be4f94.js"><link rel="prefetch" href="/assets/js/636.cb9026fe.js"><link rel="prefetch" href="/assets/js/637.25271dcb.js"><link rel="prefetch" href="/assets/js/638.fcac68d5.js"><link rel="prefetch" href="/assets/js/639.03ab08cf.js"><link rel="prefetch" href="/assets/js/64.9367ecbc.js"><link rel="prefetch" href="/assets/js/640.a8b218de.js"><link rel="prefetch" href="/assets/js/641.fadf6edc.js"><link rel="prefetch" href="/assets/js/642.81b7dc74.js"><link rel="prefetch" href="/assets/js/643.7d88f22d.js"><link rel="prefetch" href="/assets/js/644.1ec2619a.js"><link rel="prefetch" href="/assets/js/65.d98509f3.js"><link rel="prefetch" href="/assets/js/66.2679f742.js"><link rel="prefetch" href="/assets/js/67.be8ad80e.js"><link rel="prefetch" href="/assets/js/68.ee41ee8e.js"><link rel="prefetch" href="/assets/js/69.c1f11fc4.js"><link rel="prefetch" href="/assets/js/7.03df4ff4.js"><link rel="prefetch" href="/assets/js/70.e516014d.js"><link rel="prefetch" href="/assets/js/71.d5ed1231.js"><link rel="prefetch" href="/assets/js/72.0c23af08.js"><link rel="prefetch" href="/assets/js/73.f8d902ce.js"><link rel="prefetch" href="/assets/js/74.bb0d3876.js"><link rel="prefetch" href="/assets/js/75.c0c6cff8.js"><link rel="prefetch" href="/assets/js/76.37e02e83.js"><link rel="prefetch" href="/assets/js/77.63e8230d.js"><link rel="prefetch" href="/assets/js/78.96994102.js"><link rel="prefetch" href="/assets/js/79.11db88a9.js"><link rel="prefetch" href="/assets/js/8.68bfe519.js"><link rel="prefetch" href="/assets/js/80.53cb9755.js"><link rel="prefetch" href="/assets/js/81.6d4b055a.js"><link rel="prefetch" href="/assets/js/82.2397c136.js"><link rel="prefetch" href="/assets/js/83.60df89c8.js"><link rel="prefetch" href="/assets/js/84.35883c91.js"><link rel="prefetch" href="/assets/js/85.63aff4e0.js"><link rel="prefetch" href="/assets/js/86.694afafd.js"><link rel="prefetch" href="/assets/js/87.258b978b.js"><link rel="prefetch" href="/assets/js/88.0aed517f.js"><link rel="prefetch" href="/assets/js/89.abeffa8e.js"><link rel="prefetch" href="/assets/js/9.fe431f80.js"><link rel="prefetch" href="/assets/js/90.bfd23efa.js"><link rel="prefetch" href="/assets/js/91.c6b2ad01.js"><link rel="prefetch" href="/assets/js/92.1e143730.js"><link rel="prefetch" href="/assets/js/93.6c7aaa41.js"><link rel="prefetch" href="/assets/js/94.9c27cb50.js"><link rel="prefetch" href="/assets/js/95.db8de19f.js"><link rel="prefetch" href="/assets/js/96.c6152e1d.js"><link rel="prefetch" href="/assets/js/97.d231f8a9.js"><link rel="prefetch" href="/assets/js/98.96c57ebe.js"><link rel="prefetch" href="/assets/js/99.42c30508.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b0415a31.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/imgs/kriry-logo.png" alt="kriry技术" class="logo"> <span class="site-name can-hide">kriry技术</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="http://kriry.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kriry.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/read/" class="nav-link">阅读</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Rust</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rust/" class="nav-link router-link-active">Rust语言书录</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/book/" class="nav-link">Rust编程语言</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/advrust/" class="nav-link">Rust高级编程</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/reference/" class="nav-link">Rust语言参考</a></li><li class="dropdown-item"><!----> <a href="https://dev.kriry.com/www/rust/std" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Rust标准库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/rust/rust/async-rust/" class="nav-link">Rust异步编程</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/cargo/" class="nav-link">Cargo教程</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/discovery/" class="nav-link">中文《Discovery》</a></li><li class="dropdown-item"><!----> <a href="/rust/user/book-exp/" class="nav-link router-link-active">The Book-学习心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Web开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/web/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/web/webapi/" class="nav-link">WebAPI</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dba/postgresql/" class="nav-link">PostgreSQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/os/harmony/" class="nav-link">Harmony</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">协议</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/protocol/http2/" class="nav-link">HTTP2</a></li><li class="dropdown-item"><!----> <a href="/protocol/http3/" class="nav-link">HTTP3</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/actix/" class="nav-link">Actix</a></li><li class="dropdown-item"><!----> <a href="/framework/tokio/" class="nav-link">Tokio</a></li><li class="dropdown-item"><!----> <a href="/framework/serde/" class="nav-link">Serde</a></li><li class="dropdown-item"><!----> <a href="/framework/riker/" class="nav-link">Riker</a></li><li class="dropdown-item"><!----> <a href="/framework/diesel/" class="nav-link">Diesel</a></li></ul></div></div><div class="nav-item"><a href="https://weibo.com/kriry?is_all=1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/kriry/kriry-dev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="http://kriry.com" target="_blank" rel="noopener noreferrer" class="nav-link external">
  kriry.com
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/read/" class="nav-link">阅读</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Rust</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/rust/" class="nav-link router-link-active">Rust语言书录</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/book/" class="nav-link">Rust编程语言</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/advrust/" class="nav-link">Rust高级编程</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/reference/" class="nav-link">Rust语言参考</a></li><li class="dropdown-item"><!----> <a href="https://dev.kriry.com/www/rust/std" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Rust标准库
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/rust/rust/async-rust/" class="nav-link">Rust异步编程</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/cargo/" class="nav-link">Cargo教程</a></li><li class="dropdown-item"><!----> <a href="/rust/rust/discovery/" class="nav-link">中文《Discovery》</a></li><li class="dropdown-item"><!----> <a href="/rust/user/book-exp/" class="nav-link router-link-active">The Book-学习心得</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Web开发</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/web/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/web/webapi/" class="nav-link">WebAPI</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dba/postgresql/" class="nav-link">PostgreSQL</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">操作系统</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/os/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/os/harmony/" class="nav-link">Harmony</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">协议</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/protocol/http2/" class="nav-link">HTTP2</a></li><li class="dropdown-item"><!----> <a href="/protocol/http3/" class="nav-link">HTTP3</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">框架</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/actix/" class="nav-link">Actix</a></li><li class="dropdown-item"><!----> <a href="/framework/tokio/" class="nav-link">Tokio</a></li><li class="dropdown-item"><!----> <a href="/framework/serde/" class="nav-link">Serde</a></li><li class="dropdown-item"><!----> <a href="/framework/riker/" class="nav-link">Riker</a></li><li class="dropdown-item"><!----> <a href="/framework/diesel/" class="nav-link">Diesel</a></li></ul></div></div><div class="nav-item"><a href="https://weibo.com/kriry?is_all=1" target="_blank" rel="noopener noreferrer" class="nav-link external">
  微博
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <a href="https://github.com/kriry/kriry-dev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/rust/user/book-exp/" class="sidebar-link">「Rust-the-Book」学习心得</a></li><li><a href="/rust/user/book-exp/01 Getting Started/01 Getting Started.html" class="sidebar-link">开始</a></li><li><a href="/rust/user/book-exp/02 Programming a Guessing Game/01 Programming a Guessing Game.html" class="sidebar-link">猜谜游戏</a></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>所有权</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>结构体</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>枚举</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>模块</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>集合</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>错误处理</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>泛型及生命周期</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>自动测试</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>命令行</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>闭包及迭代器</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/rust/user/book-exp/13 Functional Programming about Closure and Iterator/01 Closures that Anonymous Functions can Capture their Environment.html" class="active sidebar-link">匿名函数 Closure</a></li><li><a href="/rust/user/book-exp/13 Functional Programming about Closure and Iterator/02 Processing a Series of Items with Iterators.html" class="sidebar-link">迭代器 Iterator</a></li><li><a href="/rust/user/book-exp/13 Functional Programming about Closure and Iterator/03 Improving Our IO Project.html" class="sidebar-link">改进 minigrep</a></li><li><a href="/rust/user/book-exp/13 Functional Programming about Closure and Iterator/04 Comparing Performance about Loop and Iterator.html" class="sidebar-link">性能比较 Loop &amp; Iterator</a></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Cargo 和 Crates.io</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="匿名函数-closure"><a href="#匿名函数-closure" aria-hidden="true" class="header-anchor">#</a> 匿名函数 Closure</h1> <h2 id="术语"><a href="#术语" aria-hidden="true" class="header-anchor">#</a> 术语</h2> <h3 id="functional-programming"><a href="#functional-programming" aria-hidden="true" class="header-anchor">#</a> <em>Functional Programming</em></h3> <ul><li>即函数式编程</li> <li>函数可以被当作一种值，从而可以赋值给变量，或作为函数的返回值</li> <li>包括 Cosure ，Iterator 等</li></ul> <h3 id="closure"><a href="#closure" aria-hidden="true" class="header-anchor">#</a> <em>Closure</em></h3> <ul><li>即匿名函数</li> <li>可以将其存储在变量中，或者作为参数传递给另一个函数</li> <li>与函数不同的是，Closure 是闭包的，也就是说它记录了被创建时的上下文环境</li> <li>因此，可以在一个位置创建 Closure ，然后在另一个上下文环境中使用它</li></ul> <h2 id="问题的提出"><a href="#问题的提出" aria-hidden="true" class="header-anchor">#</a> 问题的提出</h2> <h3 id="场景描述"><a href="#场景描述" aria-hidden="true" class="header-anchor">#</a> 场景描述</h3> <blockquote><p>为了讲解 Closure ，原文 The Book 绞尽脑汁举了个例子，关于健身计划的，代码非常蹩脚，而且实际上原文中提到的问题是可以有其它解决办法的，只是不像 Closure 那么简洁。所以本书中我们不用在意实际的场景是不是健身计划，直接用代码来描述即可。</p></blockquote> <p>首先，有个运算函数比较耗时，这个耗时过程用 <code>sleep</code> 来模拟：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 使用线程</span>
<span class="token keyword">use</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>thread<span class="token punctuation">;</span>
<span class="token comment">// 时间操作</span>
<span class="token keyword">use</span> std<span class="token punctuation">:</span><span class="token punctuation">:</span>time<span class="token punctuation">:</span><span class="token punctuation">:</span>Duration<span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function">expensive</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span>
    <span class="token comment">// sleep 2秒之后返回</span>
    thread<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    v
<span class="token punctuation">}</span>
</code></pre></div><p>然后，开始蹩脚的代码，简单来说，就是根据输入参数，会调用零次、一次、多次 <code>expensive</code> ：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">ugly</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> r<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">if</span> v <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token punctuation">{</span>	
        <span class="token comment">// 调用了两次</span>
        <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A.1 {}&quot;</span><span class="token punctuation">,</span> <span class="token function">expensive</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A.2 {}&quot;</span><span class="token punctuation">,</span> <span class="token function">expensive</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> r <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token comment">// 调用了一次</span>
            <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;B.1 {}&quot;</span><span class="token punctuation">,</span> <span class="token function">expensive</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 调用了零次</span>
			<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;B.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="问题改进"><a href="#问题改进" aria-hidden="true" class="header-anchor">#</a> 问题改进</h3> <p>我们打算改进代码，希望只调用一次，所以先调用函数得到结果，再根据条件判断，直接访问结果值：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">ugly</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> r<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 先调用函数得到结果</span>
	<span class="token keyword">let</span> ret <span class="token operator">=</span> <span class="token function">expensive</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
	<span class="token keyword">if</span> v <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token punctuation">{</span>
        <span class="token comment">// 两次访问结果</span>
		<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A.1 {}&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A.2 {}&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> r <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token comment">// 一次访问结果</span>
			<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;B.1 {}&quot;</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment">// 零次访问结果</span>
			<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;B.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="余留问题"><a href="#余留问题" aria-hidden="true" class="header-anchor">#</a> 余留问题</h3> <p>上面的改进方式仍然存在如下问题：</p> <ol><li>虽然避免了多次调用函数，但函数仍然总是被调用了一次</li> <li>函数总是先执行函数并等待结果，即使某些情况下并不需要调用函数，例如 <code>B.0</code></li> <li>函数和函数执行结果是两份关联的信息，但此时这两份信息是分离的</li> <li>为了存储函数执行结果，增加了局部变量，且这个局部变量所存储的信息与函数本身是分离的</li></ol> <h3 id="解决目标"><a href="#解决目标" aria-hidden="true" class="header-anchor">#</a> 解决目标</h3> <p>我们希望这个例子用下面的方式来解决，且 Closure 可以解决：</p> <ul><li>函数只被调用一次</li> <li>需要结果时才调用函数</li> <li>即使多个地方需要结果，也只调用一次函数</li> <li>如果某些地方不需要结果，则不会调用函数</li></ul> <h2 id="closure-语法"><a href="#closure-语法" aria-hidden="true" class="header-anchor">#</a> Closure 语法</h2> <h3 id="举例"><a href="#举例" aria-hidden="true" class="header-anchor">#</a> 举例</h3> <p>先看个例子，将上面的 <code>expensive</code> 函数改为 Closure 的语法：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> ret_closure <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>vc<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
    thread<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    vc
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>需要注意的是：</p> <ul><li>此时 <code>ret_closure</code> 保存的并不是函数的执行结果，而是函数本身</li> <li>定义 Closure 的时候，只是定义了函数本身，函数并没有被执行</li></ul> <h3 id="语法规则"><a href="#语法规则" aria-hidden="true" class="header-anchor">#</a> 语法规则</h3> <p>语法如下：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> var <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> <span class="token comment">/*code*/</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>语法说明：</p> <ul><li>函数用 <code>(p1, p2)</code> 来表示参数，但 Closure 用 <code>|p1, p2|</code></li> <li>Rust 认为采用 <code>|</code> 来囊括参数的原因是该语法与 Smalltalk 和 Ruby 很像，但我并不了解这两门语言</li> <li>Closure 的代码块用 <code>{}</code> ，与函数是一致的</li> <li>Closure 本身是一种数据，可以赋值给变量，因此末尾的 <code>;</code> 并不是 Closure 语法的一部分，而是 <code>let</code> 语句的结束</li> <li>如果 Closure 只有一句代码，则 <code>{}</code> 可以省略</li></ul> <h3 id="参数和返回值的类型"><a href="#参数和返回值的类型" aria-hidden="true" class="header-anchor">#</a> 参数和返回值的类型</h3> <p>从语法中可以看到：</p> <ul><li>Closure 并不需要类似函数的 <code>-&gt; type</code> 来说明返回值的类型</li> <li>而且 <code>|p1, p2|</code> 里面的参数也不需要说明类型</li></ul> <p>这就是 Cosure 与 函数的一些不同：</p> <ul><li>函数需要明确的定义函数名称、参数和返回值类型，因为函数需要提供给外部使用</li> <li>但 Closure 不需要像函数这么严格，因为 Closure 是一种数据，可以存放于变量中</li> <li>因此 Closure 不需要函数名称，不需要提供给外部使用，而且，参数和返回值类型都可以省略，这样可以让 Closure看起来简洁一些</li> <li>另外，Closure 一般在代码内部被定义和使用，所以编译器能够自动推断出参数和返回值类型</li></ul> <h3 id="语法举例"><a href="#语法举例" aria-hidden="true" class="header-anchor">#</a> 语法举例</h3> <p>下面是几种 Closure 的定义方式，可以看到有简单的写法，也有复杂的写法：</p> <blockquote><p>注意，为了对比几种写法的区别，因此故意使用了空格来进行对齐</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 函数的定义方式</span>
<span class="token keyword">fn</span>  <span class="token function">add_one_v1</span>   <span class="token punctuation">(</span>x<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span>
<span class="token comment">// Closure - 最全面的定义方式</span>
<span class="token keyword">let</span> add_one_v2 <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>x<span class="token punctuation">:</span> u32<span class="token punctuation">|</span></span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Closure - 省略返回值类型</span>
<span class="token keyword">let</span> add_one_v3 <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>x<span class="token punctuation">|</span></span>             <span class="token punctuation">{</span> x <span class="token operator">+</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Closure - 省略代码块的 {}</span>
<span class="token keyword">let</span> add_one_v4 <span class="token operator">=</span> <span class="token operator">|</span>x<span class="token operator">|</span>               x <span class="token operator">+</span> <span class="token number">1</span>  <span class="token punctuation">;</span>
</code></pre></div><h3 id="参数类型推断"><a href="#参数类型推断" aria-hidden="true" class="header-anchor">#</a> 参数类型推断</h3> <p>假设有下面这个 Closure ：</p> <blockquote><p>注意，这样的 Closure 是没有任何意义的，因为它的作用就是用来演示，因此变量名故意叫做 <code>worthless</code></p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">let</span> worthless <span class="token operator">=</span> <span class="token operator">|</span>x<span class="token operator">|</span> x<span class="token punctuation">;</span>
</code></pre></div><p>那么，此时 <code>x</code> 的类型是未知的，编译器会根据第一次对该 Closure 的调用来决定参数类型：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 此时参数x的类型被确定为i32</span>
<span class="token keyword">let</span> i1 <span class="token operator">=</span> <span class="token function">worthless</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>然后再进行一次调用，编译器报错：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token comment">// 编译器错误提示&quot;参数类型不匹配&quot;</span>
<span class="token keyword">let</span> s1 <span class="token operator">=</span> <span class="token function">worthless</span><span class="token punctuation">(</span><span class="token string">&quot;abc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="closure-类型"><a href="#closure-类型" aria-hidden="true" class="header-anchor">#</a> Closure 类型</h2> <h3 id="关于-closure-的类型"><a href="#关于-closure-的类型" aria-hidden="true" class="header-anchor">#</a> 关于 Closure 的类型</h3> <p>每个 Closure 本身的类型是唯一的：</p> <ul><li>前面讲过，Closure 本质是一种数据，而既然是数据，就会有类型</li> <li>因此，每个 Closure 都有唯一的匿名的类型，这个唯一性是编译器自行完成的</li> <li>即使两个 Closure 的 Signature (参数个数、参数类型、返回值类型等) 完全一样，它们的类型也是不一样的</li></ul> <p>为何 Closure 的类型具有唯一性：</p> <ul><li>这是我自己的理解，我认为有几方面原因</li> <li>第一，Closure 也有 Signature ，不同的 Closure 的 Signature 可能不同，这与函数是一致的</li> <li>第二，Closure 是匿名的，没有函数名，所以 Rust 需要理解为每个 Closure 的函数名都是不同的</li> <li>第三，Closure 涉及到闭包，也就是对当前上下文环境的访问，这个后续会讲。因此，一方面，每个 Closure 的上下文环境可能是不一样的；一方面，每个 Closure 对上下文环境的访问也是不同的，可能只是读取上下文数据，也可能会修改上下文数据；总之，Closure 闭包的不同，导致了每个 Closure 的不同</li> <li>在前面的例子里，Closure 都是被直接赋值给变量，所以我们不需要关注也可以忽略 Closure 本身的类型</li> <li>但是，如果要将 Closure 作为函数的参数、函数的返回值、struct 的 field，就需要说明类型，因此，在这些场景下，如何标注 Closure 的类型就成为一个问题</li></ul> <h3 id="表达-closure-的类型"><a href="#表达-closure-的类型" aria-hidden="true" class="header-anchor">#</a> 表达 Closure 的类型</h3> <p>根据前面对 Closure 类型唯一性的讲解，如果要表达 Closure 的类型，需要考虑三方面问题</p> <ol><li>Signature，即参数和返回值</li> <li>Closure 的匿名性，也就是没有函数名</li> <li>Closure 的闭包特性</li></ol> <p>因此，Rust 用下面的方式来解决这些问题：</p> <ol><li>Signature 比较简单，与函数一致，用 <code>()</code> 来表示参数，用 <code>-&gt; type</code> 来表示返回值</li> <li>Closure 的匿名性，这个不好表达，先放一下</li> <li>Closure 的闭包特性，Rust 归为三类，分别是 <code>Fn / FnMut / FnOnce</code> ，具体差异后续会讲</li></ol> <p>进一步，Rust 的思考方式是：</p> <ul><li>除了 Signature 可以明确表达，另外的匿名性和闭包特性都无法表达为确切的类型，而只能理解为一种特性</li> <li>也就是说，Closure 具备某些特性，包括匿名、闭包，而这些特性可以用 Trait 来表达</li> <li>所以，<code>Fn / FnMut / FnOnce</code> 是三种针对 Closure 的 Trait</li> <li>因此，如果要表达 Closure 的类型，需要使用 Generic 和 Trait</li></ul> <p>此处先暂时只使用 <code>Fn</code> ，我们可以顺其自然的表达出 Closure 的类型：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token function">Fn</span><span class="token punctuation">(</span>type1<span class="token punctuation">,</span> type2<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span><span class="token keyword">type</span>
</code></pre></div><p>用 struct 举例如下：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">struct</span> SthStruct<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>
	<span class="token keyword">where</span> T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32
<span class="token punctuation">{</span>
	sth_closure<span class="token punctuation">:</span> T
<span class="token punctuation">}</span>
</code></pre></div><h2 id="问题的解决"><a href="#问题的解决" aria-hidden="true" class="header-anchor">#</a> 问题的解决</h2> <p>先回顾一下前面期望的问题解决目标：</p> <ul><li>函数只被调用一次</li> <li>需要结果时才调用函数</li> <li>即使多个地方需要结果，也只调用一次函数</li> <li>如果某些地方不需要结果，则不会调用函数</li></ul> <h3 id="解决方式"><a href="#解决方式" aria-hidden="true" class="header-anchor">#</a> 解决方式</h3> <blockquote><p>首先定义 struct ，存储 Closure 和计算结果。需要注意 val 的类型是 <code>Option</code> ，因为在没有计算之前，val 的值是 <code>None</code></p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">struct</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>
	<span class="token keyword">where</span> T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32
<span class="token punctuation">{</span>
	cal<span class="token punctuation">:</span> T<span class="token punctuation">,</span>
	val<span class="token punctuation">:</span> Option<span class="token operator">&lt;</span>u32<span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>然后为该 struct 实现一些方法，注意 <code>impl</code> 写法如下</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">impl</span><span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span>
	<span class="token keyword">where</span> T<span class="token punctuation">:</span> <span class="token function">Fn</span><span class="token punctuation">(</span>u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>在  <code>impl</code> 中实现 <code>new</code> 方法，用来创建该 struct 的实例</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">new</span><span class="token punctuation">(</span>cal<span class="token punctuation">:</span> T<span class="token punctuation">)</span><span class="token punctuation">-&gt;</span> Cacher<span class="token operator">&lt;</span>T<span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    Cacher <span class="token punctuation">{</span>
        cal<span class="token punctuation">,</span>
        val<span class="token punctuation">:</span> None<span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>然后实现取值方法，思路是：如果 <code>val</code> 不是 <code>None</code> ，则直接返回；否则调用 <code>cal</code> 来计算结果</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">value</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">,</span> arg<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> u32 <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token keyword">let</span> None <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>val <span class="token punctuation">{</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>val <span class="token operator">=</span> <span class="token function">Some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">self</span><span class="token punctuation">.</span>cal<span class="token punctuation">)</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">self</span><span class="token punctuation">.</span>val<span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意：</p> <ul><li>调用 Closure 的方式是 <code>closure(arg)</code></li> <li>但是上面的代码里 Closure 是 <code>Self.cal</code> ，按照 C/C++ 的运算符结合特性，是可以写为 <code>self.cal(arg)</code> 的，因为 <code>.</code> 和 <code>()</code> 涉及的操作是从左到右结合，但 Rust 里必须写为 <code>(self.cal)(arg)</code> ，==也许是 Rust 里的运算符结合特性不同吧，暂时没有深究==</li></ul> <blockquote><p>最后，可以对前面的 <code>ugly</code> 函数改进如下</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">ugly</span><span class="token punctuation">(</span>v<span class="token punctuation">:</span> u32<span class="token punctuation">,</span> r<span class="token punctuation">:</span> u32<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 创建Cacher实例，参数是一个Closure</span>
	<span class="token keyword">let</span> <span class="token keyword">mut</span> cacher <span class="token operator">=</span> Cacher<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token punctuation">|</span>vc<span class="token punctuation">|</span></span> <span class="token punctuation">{</span>
		thread<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">sleep</span><span class="token punctuation">(</span>Duration<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">from_secs</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		vc
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> v <span class="token operator">&gt;=</span> <span class="token number">100</span> <span class="token punctuation">{</span>
        <span class="token comment">// 调用了一次Closure</span>
		<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A.1 {}&quot;</span><span class="token punctuation">,</span> cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 不再调用，直接获取结果</span>
		<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;A.2 {}&quot;</span><span class="token punctuation">,</span> cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token keyword">if</span> r <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
            <span class="token comment">// 不再调用，直接获取结果</span>
			<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;B.1 {}&quot;</span><span class="token punctuation">,</span> cacher<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;B.0&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="剩余问题"><a href="#剩余问题" aria-hidden="true" class="header-anchor">#</a> 剩余问题</h3> <p>上面的 <code>Cacher</code> 存在一些小问题：</p> <ul><li>一旦 <code>Cacher</code> 实例执行过一次计算以后，就不会再执行第二次计算</li> <li>即使每次传入的 <code>arg</code> 值不同</li></ul> <p>例如下面的例子：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">limitation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> <span class="token keyword">mut</span> c <span class="token operator">=</span> Cacher<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token operator">|</span>a<span class="token operator">|</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 调用了一次Closure</span>
    <span class="token comment">// val已经被存储，值是1</span>
	<span class="token keyword">let</span> v1 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时不再调用Closure</span>
    <span class="token comment">// 直接返回实例c中的val</span>
	<span class="token keyword">let</span> v2 <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// v2得到的结果仍然是1</span>
	<span class="token function">assert_eq!</span><span class="token punctuation">(</span>v2<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>解决办法：</p> <ul><li>可以为不同的 <code>arg</code> 创建不同的 <code>Cacher</code> 实例</li> <li>另外的办法是，<code>Cacher</code> 内的 <code>val</code> 使用 <code>HashMap</code> ，其中，key 是 <code>arg</code> ，value 是 <code>closure(arg)</code> 的结果</li></ul> <h2 id="closure-闭包"><a href="#closure-闭包" aria-hidden="true" class="header-anchor">#</a> Closure 闭包</h2> <h3 id="闭包特性"><a href="#闭包特性" aria-hidden="true" class="header-anchor">#</a> 闭包特性</h3> <p>Closure 有一个函数不具备的功能，即闭包特性，也就是说，Closure 可以访问当前 Scope 的变量。看下面的例子：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 在Closure中访问了变量x</span>
    <span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token comment">// 相当于参数8与变量x比较</span>
    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是函数不允许这种闭包特性：</p> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 编译器错误提示，函数不允许闭包</span>
    <span class="token keyword">fn</span> <span class="token function">fequalx</span><span class="token punctuation">(</span>z<span class="token punctuation">:</span> i32<span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> bool <span class="token punctuation">{</span> z <span class="token operator">==</span> x <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>关于闭包的内存：</p> <ul><li>闭包可以访问当前上下文的数据，而为了访问这些数据，可能产生内存的消耗</li> <li>例如数据的拷贝，数据的引用，所有权的转移等</li> <li>这些内存的消耗是 Rust 自动完成的，但程序员仍然需要知道这个事实</li> <li>函数不允许闭包，因此不会产生这些间接的内存消耗</li></ul> <p>根据闭包对上下文数据的访问方式，一共有三种 Trait ，且编译器能够自动推断出属于哪一种 Trait ：</p> <ul><li><code>Fn</code> ，只读取数据，本质是对数据的 <code>&amp;</code></li> <li><code>FnMut</code> ，修改数据内容，本质是对数据的 <code>&amp;mut</code></li> <li><code>FnOnce</code> ，对数据 Move 操作，The Book 说每个 Closure 都实现了 <code>FnOnce</code> 这个 Trait ，因为每个 Closure 都可以被调用至少一次，即 Once ，==但恕我理解不了，也不知道至少被调用 Once 的意义是什么，在我看来，<code>Fn</code> 的频率更高==</li></ul> <h3 id="fn"><a href="#fn" aria-hidden="true" class="header-anchor">#</a> <code>Fn</code></h3> <p>要注意的是：</p> <ol><li>只对上下文数据进行读取操作</li> <li>因此如果编译器看到 Closure 对上下文数据只有读取行为，就推断为 <code>Fn</code></li> <li>因此容易忽略的点是，在 Closure 访问上下文数据时，本质是一种 Borrow ，即使是 <code>i32</code> 数据</li></ol> <blockquote><p>先看最简单的例子</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时Closure中其实是&amp;x</span>
    <span class="token comment">// 只是编译器自动解引用了</span>
    <span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>为了证明上面的 Closure 其实是 &amp;x ，可以做出如下修改</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时产生了&amp;x</span>
    <span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token comment">// 此时不允许x自身修改</span>
    x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>错误剖析：</p> <ul><li>编译器错误提示：在 Borrow 期间，不允许被引用的数据内容修改</li> <li>具体可以参考对所有权的讲解章节</li> <li>因此这个例子很清楚的看到，Closure 中使用的是 <code>&amp;x</code></li></ul> <blockquote><p>再看一个例子，不使用 i32 这种简单类型，使用 Vector</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时使用的是 &amp;x</span>
    <span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// x仍然能够被访问</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fnmut"><a href="#fnmut" aria-hidden="true" class="header-anchor">#</a> <code>FnMut</code></h3> <p>先说规则：</p> <ul><li>如果对上下文数据产生了修改，则是 <code>FnMut</code></li> <li>如果 Closure 是 <code>FnMut</code> ，则存储 Closure 的变量也必须是 <code>mut</code> 修饰</li> <li>如果 Closure 是 <code>FnMut</code> ，则只能使用 <code>mut</code> 变量来存储，但是 <code>mut</code> 变量可以存储 <code>Fn</code> 这种 Closure ，虽然这没有什么意义</li> <li>用 <code>mut</code> 变量来存储 <code>FnMut</code> ，只是表达了 <code>FnMut</code> 这个特性，而不是变量本身的值可以被修改</li> <li>只要有任何对上下文数据的修改行为，则必须是 <code>FnMut</code> ，即使对其它的数据只进行读取</li></ul> <blockquote><p>先看一个简单例子，说明 <code>FnMut</code> 本质是 <code>&amp;mut</code></p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token comment">// 此时产生了 &amp;mut x</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> equalx <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>z<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> z <span class="token operator">==</span> x <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token comment">// 此时不允许x自身修改</span>
    x <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>如果不对变量增加 <code>mut</code> 修饰，则编译器报错</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
	<span class="token comment">// 移除了 mut 修饰</span>
    <span class="token comment">// 编译器错误提示：mut Closure 才能使用 &amp;mut x</span>
    <span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>z<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> z <span class="token operator">==</span> x <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>可以使用 <code>mut</code> 变量来存储 <code>Fn</code> ，虽然这没有任何意义，编译器也会给出 warnning</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时使用 mut 修饰是没有意义的</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>存储 <code>FnMut</code> 的变量虽然是 <code>mut</code> 修饰，但不代表该变量本身可以被改变</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时equalx变量的类型已经确定</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>
    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 编译器错误提示：Closure类型不同</span>
    equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>错误剖析：</p> <ul><li>在对 <code>equalx</code> 重新赋值时，编译器的错误提示原文是 <code>expected closure, found a different closure</code></li> <li>由此可见，我们也可以理解为，<code>equalx</code> 是 <code>mut</code> 变量，可以被重新赋值，但是此时赋值给 <code>equalx</code> 的数据类型不匹配，虽然两个 Closure 看着是一模一样的</li> <li>这也再次印证了前面讲到的 Closure 类型，每个 Closure 都有唯一的匿名类型</li> <li>因此，即使变量是 <code>mut</code> 修饰，即使变量可以被重新赋值，但我们已经无法找到第二个符合其 Closure 类型的数据了</li> <li>所以，我们也可以直接理解为，存储 <code>FnMut</code> 的变量本身的值无法被改变，即使它是 <code>mut</code> 修饰</li></ul> <blockquote><p>只要对任何上下文数据进行过修改，则必须是 <code>FnMut</code> ，即使对其它数据只是读取操作</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token comment">// 对x进行了修改，对y只是读取</span>
    <span class="token comment">// 但仍然必须使用mut来修饰equaly</span>
    <span class="token comment">// 否则编译器报错</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> equaly <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>z<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> x <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span> z <span class="token operator">==</span> y <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equaly</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="fnonce"><a href="#fnonce" aria-hidden="true" class="header-anchor">#</a> <code>FnOnce</code></h3> <p>先说规则：</p> <ul><li>与 <code>Fn</code> 一样，使用变量存储 <code>FnOnce</code> 时，不需要对变量增加 <code>mut</code> 修饰，只有 <code>FnMut</code> 才需要对变量进行 <code>mut</code> 修饰</li> <li>当然，即使要为变量增加 <code>mut</code> 修饰，编译器也只是给出 wanning ，因为这样做没有任何意义</li> <li>编译器在推断闭包行为时，可能会有歧义，可以推断为 <code>Fn</code> ，也可以推断为 <code>FnOnce</code> ，此时编译器就会使用 <code>Fn</code> ，而不是 <code>FnOnce</code></li> <li>因此，可以使用 <code>move</code> 来修饰 Closure ，强制要求编译器将 Closure 推断为 <code>FnOnce</code></li> <li>但要注意的是，Move 行为对于简单类型来说，其实是 Copy ，对于对象来说，才是 Move ，才涉及到所有权的转变，参考讲解所有权的章节</li> <li>因此，有时候对于简单类型例如 i32 来说，强制使用 <code>move</code> 可以简化一些程序逻辑</li></ul> <blockquote><p>先看一个 <code>FnOnce</code> 的例子</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// x被赋值给m，因此x的所有权被move给m</span>
    <span class="token comment">// 在此Closure之后，x已不再可用</span>
    <span class="token comment">// 因此sth_move的Trait是FnOnce</span>
    <span class="token keyword">let</span> sth_move <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>z<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> <span class="token keyword">let</span> m <span class="token operator">=</span> x<span class="token punctuation">;</span> m <span class="token operator">==</span> z <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">sth_move</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 此时访问x，编译器错误提示：</span>
    <span class="token comment">// &quot;x已被move，不可访问&quot;</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>下面的例子，编译器推断为 <code>Fn</code> ，而不是 <code>FnOnce</code> ，注意看注释</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时编译器推断为Fn</span>
    <span class="token comment">// 而不是FnOnce</span>
	<span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

    <span class="token comment">// 因此编译器错误提示：</span>
    <span class="token comment">// 被Borrow的数据不允许改变</span>
	x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

	<span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>下面的例子使用的 Vector 类型，可以看到并没有被 Move</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时使用的是 &amp;x</span>
	<span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

	<span class="token function">equalx</span><span class="token punctuation">(</span><span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时x仍然可以被访问</span>
	<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>对于简单类型，强制要求编译器推断为 <code>FnOnce</code> ，而不是 <code>Fn</code> ，使用关键字 <code>move</code></p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> <span class="token keyword">mut</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时x被Move</span>
	<span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>
    <span class="token comment">// 因此x是简单类型</span>
    <span class="token comment">// 所以本质是拷贝了x</span>
    <span class="token comment">// 因此x仍然可用</span>
	x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token comment">// 只有4才相等</span>
	<span class="token function">assert!</span><span class="token punctuation">(</span><span class="token function">equalx</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>代码剖析：</p> <ul><li>上述代码强制使用了 <code>move</code></li> <li>但是对于简单类型，例如例子中的 <code>x</code> 是 <code>i32</code> ，因此 <code>move</code> 的本质是拷贝了 <code>x</code></li> <li>所以，相当于 Closure 自己开辟了空间来存储 <code>i32</code> 数据</li> <li>因此，此时 Closure 所存储的 <code>x</code> 的值被固定了，也就是 4</li> <li>所以，之后 <code>x</code> 仍然可用，也没被 Borrow ，可以修改 <code>x</code> 的值</li> <li>但是，不管后续对 <code>x</code> 的值如何修改，Closure 中存储的值都是 4</li></ul> <blockquote><p>现在再看 Vector ，强制要求编译器推断为 <code>FnOnce</code> ，而不是 <code>Fn</code> ，使用关键字 <code>move</code></p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

	<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token comment">// 此时x被强制move</span>
	<span class="token keyword">let</span> equalx <span class="token operator">=</span> <span class="token keyword">move</span> <span class="token operator">|</span>z<span class="token operator">|</span> z <span class="token operator">==</span> x<span class="token punctuation">;</span>

	<span class="token function">equalx</span><span class="token punctuation">(</span><span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 编译器报错</span>
    <span class="token comment">// 此时x已不可访问</span>
	<span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="closure-参数"><a href="#closure-参数" aria-hidden="true" class="header-anchor">#</a> Closure 参数</h2> <p>何时需要显式标注 Closure 的参数：</p> <ul><li>虽然前面讲过，我们不需要显式的标注 Closure 的参数类型</li> <li>但是在某些情况下，对 Closure 参数的标注是必须的，因为 Closure 也同样涉及到对实参所有权的影响</li> <li>下面需要几个例子来展示一些需要标注 Closure 参数的情况，但这些例子是不全的，只是抛砖引玉</li> <li>从下面的例子能够看到，编译器对 Closure 的实参，默认是按照 Move 的方式来传递的，如果我们的实参传递方式变化，例如 <code>&amp;</code> 方式，则都需要我们显式的标注 Closure 的形参</li></ul> <blockquote><p>下面的例子，看到作为参数传入的 Vector 被 Move 了</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 首先是x被move</span>
    <span class="token keyword">let</span> sth_move <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>z<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> <span class="token keyword">let</span> m <span class="token operator">=</span> x<span class="token punctuation">;</span> m <span class="token operator">==</span> z <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 然后y的参数传递方式导致也被move</span>
    <span class="token function">sth_move</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 编译器报错，x不可访问</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 编译器报错，y不可访问</span>
    <span class="token function">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:?}&quot;</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>因此，尝试更改参数传递方式为 <code>&amp;</code>，并让编译器自动推断 Closure 的形参类型</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// x被move</span>
    <span class="token comment">// y被传递的是引用</span>
    <span class="token comment">// 因此此时需要对y手动解引用</span>
    <span class="token comment">// 即 *z</span>
    <span class="token keyword">let</span> sth_move <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>z<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> <span class="token keyword">let</span> m <span class="token operator">=</span> x<span class="token punctuation">;</span> m <span class="token operator">==</span> <span class="token operator">*</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 实参用引用方式传入</span>
    <span class="token comment">// 并且期望编译器自动推断Closure的参数z类型</span>
    <span class="token comment">// 但实际上编译器无法推断</span>
    <span class="token function">sth_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>错误剖析：</p> <ul><li>我们不希望 <code>y</code> 被 Move</li> <li>因此传递实参时，使用了 <code>&amp;y</code> 的方式</li> <li>所以我们希望编译器自动推断 Closure 的形参 <code>z</code> 的类型为 <code>&amp;Vec&lt;i32&gt;</code></li> <li>但编译器自动推断失败了，==其实我很费解为何此时编译器不能推断出来==</li> <li>编译器的错误提示是：<code>consider giving this closure parameter a type, type must be known at this point</code> ，仿佛有一种编译器在求饶的既视感</li></ul> <blockquote><p>因此，对于上面的例子，我们需要标注 Closure 的形参类型</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token function">vec!</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// 标注参数z的类型为&amp;Vec&lt;i32&gt;</span>
    <span class="token keyword">let</span> sth_move <span class="token operator">=</span> <span class="token closure-params"><span class="token punctuation">|</span>z<span class="token punctuation">:</span> <span class="token operator">&amp;</span>Vec&lt;i32&gt;<span class="token punctuation">|</span></span> <span class="token punctuation">{</span> <span class="token keyword">let</span> m <span class="token operator">=</span> x<span class="token punctuation">;</span> m <span class="token operator">==</span> <span class="token operator">*</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">// 实参用引用方式传入</span>
    <span class="token function">sth_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p>同样的，对于简单类型，如果使用 <code>&amp;</code> 方式传递实参，编译器也要求我们显式标注 Closure 的参数类型</p></blockquote> <div class="language-rust extra-class"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

    <span class="token comment">// 此时需要显式标注参数z的类型为&amp;i32</span>
    <span class="token comment">// 否则编译报错</span>
    <span class="token keyword">let</span> sth_move <span class="token operator">=</span> <span class="token operator">|</span>z<span class="token punctuation">:</span> <span class="token operator">&amp;</span>i32<span class="token operator">|</span> <span class="token operator">*</span>z <span class="token operator">==</span> x<span class="token punctuation">;</span>
    <span class="token comment">// 实参用引用方式传入</span>
    <span class="token function">sth_move</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/kriry/kriry-dev/edit/master/docs/rust/user/book-exp/13 Functional Programming about Closure and Iterator/01 Closures that Anonymous Functions can Capture their Environment.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">11/27/2019, 11:55:56 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.d3c8f621.js" defer></script><script src="/assets/js/623.6aaba041.js" defer></script>
  </body>
</html>
